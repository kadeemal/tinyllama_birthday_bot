## üéÅ Tinyllama —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç –¥–ª—è –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è 
–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ - —Å–æ–∑–¥–∞—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞, —Å–ø–æ—Å–æ–±–Ω–æ–≥–æ –Ω–∞–ø–æ–º–∏–Ω–∞—Ç—å –æ –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç–∞—Ö –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å
–ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏—è.

–ë–æ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—É—á–µ–Ω–Ω—É—é TinyLLama c LoRA –ø–æ–¥ –∑–∞–¥–∞—á—É –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–π —Å –î–Ω–µ–º –†–æ–∂–¥–µ–Ω–∏—è.
–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω—ã –ø–∞—Ä—Å–∏–Ω–≥–æ–º —Å–∞–π—Ç–∞ –ü–æ–∑–¥—Ä–∞–≤–æ–∫.

–ë–æ—Ç: @birthday_rmmbr_bot
### üìë –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
.
‚îú‚îÄ‚îÄ bot <------------------------- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–æ–¥–∞ –¥–ª—è –±–æ—Ç–∞
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ __init__.py
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ handlers <---------------- –•—ç–Ω–¥–ª–µ—Ä—ã
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ dates.py
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ generate.py
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ start.py
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ keyboards <--------------- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ start_buttons.py
‚îú‚îÄ‚îÄ data <------------------------ –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è TinyLLama
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ clean <------------------- –î–∞—Ç–∞—Å–µ—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ json
‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ dataset.json
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ raw <--------------------- –ü—Ä–æ–º–ø—Ç—ã –∏ –æ—Ç–≤–µ—Ç—ã –∫ –Ω–∏–º
‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ prompts.txt
‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ wishes.txt
‚îú‚îÄ‚îÄ docker-compose.yaml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ main.py
‚îú‚îÄ‚îÄ model <----------------------- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–æ–¥–∞ –¥–ª—è –º–æ–¥–µ–ª–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ __init__.py
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ inference.py
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ preprocess.py
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ train.py
‚îú‚îÄ‚îÄ README.MD
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ tinyllama <------------------- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –º–æ–¥–µ–ª—è–º–∏
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ lora-final
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ lora-finetuned
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ merged
```
### üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç—ç–∫
- **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** Python 3.10.11
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏:** Docker
- **–°–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏:** pip
- **–ì–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ:** PyTorch, Transformers, Peft
- **–ü–∞—Ä—Å–∏–Ω–≥:** bs4, Requests
- **Backend –±–æ—Ç–∞:** aiogram, SQLite
- **CLI –∏ —É—Ç–∏–ª–∏—Ç—ã:** argparse, tqdm
### üíª –ó–∞–ø—É—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
```
git clone tinyllama_birthday_bot.git
cd tinyllama_birthday_bot
python3.10 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```
### üîç –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö 
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç preprocess.py —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º --parse:
```
python model/preprocess --parse True
```
### ü§ñ –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
–î–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç train.py
```
python model/train.py
```
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ data/clean/ –±—É–¥–µ—Ç —Ñ–∞–π–ª dataset.json, –æ–¥–Ω–∞–∫–æ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å –ø—É—Ç—å –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç:
```
python model/train.py --dataset_path "/data/clean/dataset.json"
```
–¢–∞–∫–∂–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å LR –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö. 
```
usage: train.py [-h] [--lr LR] [--epochs EPOCHS] [--dataset_path DATASET_PATH]

–û–±—É—á–∞–µ—Ç TinyLLama

options:
  -h, --help            show this help message and exit
  --lr LR               Learning Rate
  --epochs EPOCHS       –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö
  --dataset_path DATASET_PATH
                        –ü—É—Ç—å –∫ –¥–∞—Ç–∞—Å–µ—Ç—É
```
### ‚úîÔ∏è –õ–æ–∫–∞–ª—å–Ω—ã–π –∏–Ω—Ñ–µ—Ä–µ–Ω—Å
–î–ª—è –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:
```
python model/inference.py --prompt "–ü–æ–∑–¥—Ä–∞–≤—å —Å –î–†"
```
### üéâ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```
python main.py
```
### üê≥ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ Docker
```
docker compose run --rm -it --service-ports app
```
–ù–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∞—Ç—å, –∏ –±–æ—Ç –≤ –∞–ø—Ç–∞–π–º–µ.
### üìö –û–±—É—á–µ–Ω–∏–µ –Ω–∞ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö 
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ json —Å –¥–∞—Ç–∞—Å–µ—Ç–æ–º —Å–ª–µ–¥—É—é—â–∞—è:
```
{
    "prompt_0": "### Instruction: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∏—Å–∫—Ä–µ–Ω–Ω–∏–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏–∫–∞\n### Response: –ñ–µ–ª–∞—é —Ç–µ–±–µ –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, —á—Ç–æ –±—ã –≤–µ—Å—å –º–∏—Ä –±—ã–ª —Ç–µ–±–µ –æ—Ç–∫—Ä—ã—Ç, —É—Å—Ç–æ–π—á–∏–≤–æ–π –ø—Å–∏—Ö–∏–∫–∏, –¥–∞ —Ç–∞–∫–æ–π, —á—Ç–æ –±—ã –∂–∏–∑–Ω—å, –ø–∏–Ω–∞—è —Ç–µ–±—è, –ª–æ–º–∞–ª–∞ —Å–µ–±–µ –Ω–æ–≥—É. –ñ–µ–ª–∞—é —Å—á–∞—Å—Ç—å—è, —á—Ç–æ –±—ã –≤—Å–µ –≤ —Ç–µ–±–µ —Ä–∞–¥–æ–≤–∞–ª–æ—Å—å –∫–∞–∂–¥–æ–º—É –ø—Ä–æ–∂–∏—Ç–æ–º—É –¥–Ω—é, –∏ –ª—é–±–≤–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–∑–∞—Ä–∏—Ç —Ç–≤–æ—é –∂–∏–∑–Ω—å –Ω–æ–≤—ã–º–∏ –∫—Ä–∞—Å–∫–∞–º–∏. –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è —Ç–µ–±—è!", 
    "prompt_1": "### Instruction: –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –∏—Å–∫—Ä–µ–Ω–Ω–∏–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø—Ä–∞–∑–¥–Ω–∏–∫–∞\n### Response: –° –¥–Ω–µ–º —Ä–æ–∂–¥–µ–Ω–∏—è! –ñ–µ–ª–∞—é —Ç–µ–±–µ –Ω–∞—Å—Ç–æ—è—â–∏—Ö, –≤–µ—Ä–Ω—ã—Ö –∏ –æ—Ç–∑—ã–≤—á–∏–≤—ã—Ö –¥—Ä—É–∑–µ–π. –ê –≤ –¥–æ–º–µ –≤—Å–µ–≥–¥–∞ –±—ã–ª —É—é—Ç –∏ –ø–æ—Ä—è–¥–æ–∫, —á—Ç–æ–±—ã –æ–Ω –Ω–∞–≥—Ä–∞–∂–¥–∞–ª —Ö–æ–∑—è–∏–Ω–∞ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ–º –∏ –º–æ—Ä–µ–º —ç–Ω–µ—Ä–≥–∏–∏. –ù–∞ —Ä–∞–±–æ—Ç–µ –∂–µ–ª–∞—é –∫–∞—Ä—å–µ—Ä–Ω–æ–≥–æ —Ä–æ—Å—Ç–∞ –∏ —Ö–æ—Ä–æ—à–µ–≥–æ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–∞."
    ...
    "prompt_n": "### Instruction: ...\n### Responce: ..."
}
```
–ü—Ä–æ–º–ø—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ data/raw/prompts.txt, –ø–æ–∂–µ–ª–∞–Ω–∏—è - –≤ data/raw/wishes.txt. 

–ö–∞–∂–¥—ã–π txt —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ —Å –¥–∞–Ω–Ω—ã–º–∏. –ù–∞–ø—Ä–∏–º–µ—Ä:
```
–ù–∞–ø–∏—à–∏ —Ç—ë–ø–ª–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –î–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è

–°–æ—Å—Ç–∞–≤—å –∏—Å–∫—Ä–µ–Ω–Ω–µ–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ –Ω–∞ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è

–ü—Ä–∏–¥—É–º–∞–π –¥–æ–±—Ä–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ –±–µ–∑ –∫–ª–∏—à–µ

–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –ø–æ–∂–µ–ª–∞–Ω–∏–µ –∫–æ –î–Ω—é —Ä–æ–∂–¥–µ–Ω–∏—è
...
```
–ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ txt, —Ç–æ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É
```
python model/preprocess --parse False
```
–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å json –≤ –Ω—É–∂–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.
### üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL + Redis –¥–ª—è –±–æ–ª–µ–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π;
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö;
- –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ "–ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤" –¥–ª—è –±–æ—Ç–∞.